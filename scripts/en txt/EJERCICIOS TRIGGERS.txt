--EJERCICIOS CON TRIGGERS
--TRABAJAREMOS CON EL ESQUEMA INF272 Y CREAREMOS UNA TABLA "TABLA_LOG"
--DONDE ALMACENAREMOS CADA VEZ QUE HACEMOS UNA OPERACION SOBRE ESA TABLA
--SE ALMACENEN LOGS DE ACCESO

--CREAMOSA LA TABLA TABLA_LOG
CREATE TABLE TABLA_LOG
(DESCRIP VARCHAR2(30),
USUARIO VARCHAR2(30),
FECHA DATE
);


--CREAMOS UN TRIGGER PARA QUE CADA VEZ QUE SE INSERTE UN REGISTRO EN LA TABLA DPTOPRUEBA
--ALMACENE UN REGISTRO DE LOG EN LA TABLA_LOG

CREATE OR REPLACE TRIGGER INS_DPTOPRUEBA
     AFTER INSERT ON DPTOPRUEBA
BEGIN
     INSERT INTO TABLA_LOG VALUES ('INSERCION DEPTO',USER,sysdate);
END;
/


--INSERTAMOS REGISTROS EN LA TABLA DPTOPRUEBA Y VEMOS QUE PASA EN LA TABLA_LOG
INSERT INTO DPTOPRUEBA
(depnro,nom_dep,ciudad) values (SEQ_CODDEP.NEXTVAL,'Gerencia Operativa','Potos√≠');

INSERT INTO DPTOPRUEBA
(depnro,nom_dep,ciudad) values (SEQ_CODDEP.NEXTVAL,'Gerencia Desarrollo Organizaciopnal','Chuquisaca');

COMMIT;

--VERIFICAMOS SI SE HAN INSERTADO LOS VALORES EN LA TABLA_LOG
SELECT * FROM TABLA_LOG;

--CREAMOS U TRIGGER PARA QUEW CADA VEZ QUE INSERTEMOS EN LA TABLA EMPPRUEBA SE GUARDE EN TABLA_LOG
CREATE OR REPLACE TRIGGER INS_EMPPRUEBA
     AFTER INSERT ON EMPPRUEBA
BEGIN
     INSERT INTO TABLA_LOG VALUES ('INSERCION EMPLEADO',USER,sysdate);
END;
/

--INSERTAMOS REGISTRO EN LA TABLA EMPPRUEBA
INSERT INTO EMPPRUEBA (empnro,nomemp,apeemp,cargo,fechaing,salario,email,depnro)
values (SEQ_CODEMP.NEXTVAL,'Alberto','Manzanedo','Gerente operativo',TO_DATE('18/05/2021','dd/mm/yyyy'),20000,null,10);

INSERT INTO EMPPRUEBA (empnro,nomemp,apeemp,cargo,fechaing,salario,email,depnro)
values (SEQ_CODEMP.NEXTVAL,'Tania','Jimenez','Vendedor',TO_DATE('18/05/2021','dd/mm/yyyy'),2000,null,8);

COMMIT; 

--VERICAMOS CONTENIDO DE NUESTRA TABLA_LOG
SELECT * FROM TABLA_LOG;


--ALGUNOS COMANDOS SQL PARA TRABAJAR SOBRE EL OBJETO TRIGGER
DESC USER_TRIGGERS;

SELECT * FROM USER_TRIGGERS;

SELECT TRIGGER_NAME,ACTION_TYPE,TRIGGER_BODY FROM USER_TRIGGERS;

SELECT OBJECT_NAME,OBJECT_TYPE,STATUS FROM USER_OBJECTS WHERE OBJECT_TYPE='TRIGGER';
